--[[
    ðŸ’  NDT-Hub MM2 Premium ðŸ’ 
    Features:
    - ESP HITBOX cao cáº¥p (hitbox bÃ¡m sÃ¡t + highlight xuyÃªn tÆ°á»ng)
    - Noclip: Äi xuyÃªn váº­t cáº£n
    - Teleport Ä‘áº¿n Gun Drop
    - Find Coin (TP Ä‘áº¿n Coin_Server 40 láº§n)
    - Aimbot chÃ­nh xÃ¡c
    - Fly mÆ°á»£t mÃ 
    - Anti-AFK
    - Giao diá»‡n Ä‘áº¹p vá»›i hiá»‡u á»©ng
]]

local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local CoreGui = game:GetService("CoreGui")
local TweenService = game:GetService("TweenService")

-- MÃ u sáº¯c chá»§ Ä‘áº¡o
local PrimaryColor = Color3.fromRGB(10, 25, 50)
local SecondaryColor = Color3.fromRGB(25, 80, 150)
local AccentColor = Color3.fromRGB(0, 162, 255)

-- MÃ u ESP HITBOX
local MurdererColor = Color3.fromRGB(255, 50, 50)  -- Äá»
local SheriffColor = Color3.fromRGB(50, 50, 255)   -- Xanh dÆ°Æ¡ng
local InnocentColor = Color3.fromRGB(50, 255, 50) -- Xanh lÃ¡
local HighlightTransparency = 0.7  -- Äá»™ trong suá»‘t highlight

local LocalPlayer = Players.LocalPlayer
local ESPEnabled = false
local AimbotEnabled = false
local FlyEnabled = false
local AntiAFKEnabled = true
local NoclipEnabled = false
local FindCoinEnabled = false
local Spectating = false
local SpectatingPlayer = nil

local ESPHitboxes = {}
local CoinTPCount = 0
local MaxCoinTP = 40
local CoinTPDelay = 0.5
local SafeHeight = 3

-- Táº¡o GUI cao cáº¥p
local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "NDTHub_"..tostring(math.random(1000,9999))
ScreenGui.Parent = CoreGui
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

local MainFrame = Instance.new("Frame")
MainFrame.Size = UDim2.new(0, 320, 0, 450) -- Increased height for new buttons
MainFrame.Position = UDim2.new(0.5, -160, 0.5, -225)
MainFrame.BackgroundColor3 = PrimaryColor
MainFrame.BorderSizePixel = 0
MainFrame.Active = true
MainFrame.Draggable = true

-- Hiá»‡u á»©ng bo gÃ³c
local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 8)
UICorner.Parent = MainFrame

local UIStroke = Instance.new("UIStroke")
UIStroke.Color = SecondaryColor
UIStroke.Thickness = 2
UIStroke.Parent = MainFrame

-- Hiá»‡u á»©ng hover
MainFrame.MouseEnter:Connect(function()
    TweenService:Create(UIStroke, TweenInfo.new(0.3), {Color = AccentColor}):Play()
end)

MainFrame.MouseLeave:Connect(function()
    TweenService:Create(UIStroke, TweenInfo.new(0.3), {Color = SecondaryColor}):Play()
end)

MainFrame.Parent = ScreenGui

-- Title Bar vá»›i hiá»‡u á»©ng
local TitleBar = Instance.new("Frame")
TitleBar.Size = UDim2.new(1, 0, 0, 40)
TitleBar.Position = UDim2.new(0, 0, 0, 0)
TitleBar.BackgroundColor3 = SecondaryColor
TitleBar.BorderSizePixel = 0

local TitleCorner = Instance.new("UICorner")
TitleCorner.CornerRadius = UDim.new(0, 8)
TitleCorner.Parent = TitleBar

local Title = Instance.new("TextLabel")
Title.Size = UDim2.new(1, -20, 1, 0)
Title.Position = UDim2.new(0, 10, 0, 0)
Title.BackgroundTransparency = 1
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.Text = "ðŸ’  NDT-Hub MM2 ðŸ’ "
Title.Font = Enum.Font.GothamBold
Title.TextSize = 16
Title.Parent = TitleBar

TitleBar.Parent = MainFrame

-- Tab Buttons
local TabButtons = Instance.new("Frame")
TabButtons.Size = UDim2.new(1, -20, 0, 30)
TabButtons.Position = UDim2.new(0, 10, 0, 45)
TabButtons.BackgroundTransparency = 1
TabButtons.Parent = MainFrame

local ESPTabButton = Instance.new("TextButton")
ESPTabButton.Size = UDim2.new(0.5, -5, 1, 0)
ESPTabButton.Position = UDim2.new(0, 0, 0, 0)
ESPTabButton.BackgroundColor3 = SecondaryColor
ESPTabButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ESPTabButton.Text = "ESP"
ESPTabButton.Font = Enum.Font.GothamBold
ESPTabButton.TextSize = 14

local TabCorner = Instance.new("UICorner")
TabCorner.CornerRadius = UDim.new(0, 6)
TabCorner.Parent = ESPTabButton

ESPTabButton.Parent = TabButtons

local MovementTabButton = Instance.new("TextButton")
MovementTabButton.Size = UDim2.new(0.5, -5, 1, 0)
MovementTabButton.Position = UDim2.new(0.5, 5, 0, 0)
MovementTabButton.BackgroundColor3 = PrimaryColor
MovementTabButton.TextColor3 = Color3.fromRGB(255, 255, 255)
MovementTabButton.Text = "MOVEMENT"
MovementTabButton.Font = Enum.Font.GothamBold
MovementTabButton.TextSize = 14

local MovementCorner = Instance.new("UICorner")
MovementCorner.CornerRadius = UDim.new(0, 6)
MovementCorner.Parent = MovementTabButton

MovementTabButton.Parent = TabButtons

-- Content Frame
local ContentFrame = Instance.new("Frame")
ContentFrame.Size = UDim2.new(1, -20, 1, -85)
ContentFrame.Position = UDim2.new(0, 10, 0, 80)
ContentFrame.BackgroundTransparency = 1
ContentFrame.Parent = MainFrame

-- ESP Tab
local ESPFrame = Instance.new("Frame")
ESPFrame.Size = UDim2.new(1, 0, 1, 0)
ESPFrame.BackgroundTransparency = 1
ESPFrame.Visible = true
ESPFrame.Parent = ContentFrame

-- HÃ m táº¡o button vá»›i hiá»‡u á»©ng
local function CreateButton(text, yPos)
    local button = Instance.new("TextButton")
    button.Size = UDim2.new(1, 0, 0, 35)
    button.Position = UDim2.new(0, 0, 0, yPos)
    button.BackgroundColor3 = SecondaryColor
    button.TextColor3 = Color3.fromRGB(255, 255, 255)
    button.Text = text
    button.Font = Enum.Font.GothamBold
    button.TextSize = 14
    button.AutoButtonColor = false
    
    local buttonCorner = Instance.new("UICorner")
    buttonCorner.CornerRadius = UDim.new(0, 6)
    buttonCorner.Parent = button
    
    local buttonStroke = Instance.new("UIStroke")
    buttonStroke.Color = AccentColor
    buttonStroke.Thickness = 1
    buttonStroke.Parent = button
    
    -- Hiá»‡u á»©ng hover
    button.MouseEnter:Connect(function()
        TweenService:Create(button, TweenInfo.new(0.2), {BackgroundColor3 = AccentColor}):Play()
        TweenService:Create(buttonStroke, TweenInfo.new(0.2), {Color = Color3.fromRGB(255, 255, 255)}):Play()
    end)
    
    button.MouseLeave:Connect(function()
        TweenService:Create(button, TweenInfo.new(0.2), {BackgroundColor3 = SecondaryColor}):Play()
        TweenService:Create(buttonStroke, TweenInfo.new(0.2), {Color = AccentColor}):Play()
    end)
    
    return button
end

local ESPToggle = CreateButton("ESP HITBOX: OFF", 10)
ESPToggle.Parent = ESPFrame

local AimbotToggle = CreateButton("AIMBOT: OFF", 55)
AimbotToggle.Parent = ESPFrame

local NoclipToggle = CreateButton("NOCLIP: OFF", 100)
NoclipToggle.Parent = ESPFrame

local TpGunDropButton = CreateButton("TP GUN DROP", 145)
TpGunDropButton.Parent = ESPFrame

local FindCoinToggle = CreateButton("FIND COIN: OFF ("..MaxCoinTP..")", 190)
FindCoinToggle.Parent = ESPFrame

local CoinCounter = Instance.new("TextLabel")
CoinCounter.Size = UDim2.new(1, 0, 0, 20)
CoinCounter.Position = UDim2.new(0, 0, 0, 230)
CoinCounter.BackgroundTransparency = 1
CoinCounter.TextColor3 = AccentColor
CoinCounter.Text = "Remaining: "..MaxCoinTP
CoinCounter.Font = Enum.Font.GothamBold
CoinCounter.TextSize = 12
CoinCounter.Parent = ESPFrame

local SpectateButton = CreateButton("SPECTATE PLAYER", 255)
SpectateButton.Parent = ESPFrame

local SpectateList = Instance.new("ScrollingFrame")
SpectateList.Size = UDim2.new(1, 0, 0, 150)
SpectateList.Position = UDim2.new(0, 0, 0, 300)
SpectateList.BackgroundColor3 = PrimaryColor
SpectateList.BackgroundTransparency = 0.5
SpectateList.Visible = false
SpectateList.Parent = ESPFrame

local ListCorner = Instance.new("UICorner")
ListCorner.CornerRadius = UDim.new(0, 6)
ListCorner.Parent = SpectateList

-- Movement Tab
local MovementFrame = Instance.new("Frame")
MovementFrame.Size = UDim2.new(1, 0, 1, 0)
MovementFrame.BackgroundTransparency = 1
MovementFrame.Visible = false
MovementFrame.Parent = ContentFrame

local FlyToggle = CreateButton("FLY: OFF", 10)
FlyToggle.Parent = MovementFrame

local AntiAFKToggle = CreateButton("ANTI-AFK: ON", 55)
AntiAFKToggle.Parent = MovementFrame

-- ========== CÃC CHá»¨C NÄ‚NG CHÃNH ========== --

-- HÃ m Noclip
local function Noclip()
    if not NoclipEnabled or not LocalPlayer.Character then return end
    
    for _, part in ipairs(LocalPlayer.Character:GetDescendants()) do
        if part:IsA("BasePart") then
            part.CanCollide = false
        end
    end
end

-- HÃ m tÃ¬m Gun Drop
local function FindGunDrop()
    for _, obj in pairs(Workspace:GetDescendants()) do
        if obj.Name == "GunDrop" and obj:IsA("BasePart") then
            return obj
        end
    end
    return nil
end

-- HÃ m Teleport Ä‘áº¿n Gun Drop
local function TeleportToGunDrop()
    local gunDrop = FindGunDrop()
    if gunDrop and LocalPlayer.Character then
        local humanoidRootPart = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
        if humanoidRootPart then
            humanoidRootPart.CFrame = gunDrop.CFrame + Vector3.new(0, SafeHeight, 0)
        end
    end
end

-- HÃ m Find Coin
local function FindCoinParts()
    local coins = {}
    for _, obj in pairs(Workspace:GetDescendants()) do
        if obj.Name == "Coin_Server" and obj:IsA("BasePart") then
            table.insert(coins, obj)
        elseif obj.Name == "CoinContainer" then
            local coin = obj:FindFirstChild("Coin_Server")
            if coin and coin:IsA("BasePart") then
                table.insert(coins, coin)
            end
        end
    end
    return coins
end

local function TeleportToCoin()
    if not FindCoinEnabled or CoinTPCount >= MaxCoinTP then return end
    if not LocalPlayer.Character then return end

    local coins = FindCoinParts()
    if #coins > 0 then
        local closestCoin = nil
        local minDistance = math.huge
        
        for _, coin in pairs(coins) do
            local distance = (LocalPlayer.Character.HumanoidRootPart.Position - coin.Position).Magnitude
            if distance < minDistance then
                minDistance = distance
                closestCoin = coin
            end
        end

        if closestCoin then
            LocalPlayer.Character.HumanoidRootPart.CFrame = closestCoin.CFrame + Vector3.new(0, SafeHeight, 0)
            CoinTPCount = CoinTPCount + 1
            CoinCounter.Text = "Remaining: "..(MaxCoinTP - CoinTPCount)
        end
    end

    if FindCoinEnabled and CoinTPCount < MaxCoinTP then
        task.delay(CoinTPDelay, TeleportToCoin)
    else
        FindCoinEnabled = false
        FindCoinToggle.Text = "FIND COIN: OFF ("..MaxCoinTP..")"
        CoinTPCount = 0
    end
end

-- ========== CÃC Káº¾T Ná»I CHÃNH ========== --

-- Káº¿t ná»‘i Noclip
RunService.Stepped:Connect(Noclip)

-- Toggle functions
NoclipToggle.MouseButton1Click:Connect(function()
    NoclipEnabled = not NoclipEnabled
    NoclipToggle.Text = "NOCLIP: " .. (NoclipEnabled and "ON" or "OFF")
end)

TpGunDropButton.MouseButton1Click:Connect(TeleportToGunDrop)

FindCoinToggle.MouseButton1Click:Connect(function()
    FindCoinEnabled = not FindCoinEnabled
    if FindCoinEnabled then
        CoinTPCount = 0
        CoinCounter.Text = "Remaining: "..MaxCoinTP
        FindCoinToggle.Text = "FIND COIN: ON ("..MaxCoinTP..")"
        TeleportToCoin()
    else
        FindCoinToggle.Text = "FIND COIN: OFF ("..MaxCoinTP..")"
    end
end)

-- [PHáº¦N CÃ’N Láº I Cá»¦A SCRIPT GIá»® NGUYÃŠN...]
-- Bao gá»“m cÃ¡c hÃ m ESP, Fly, Aimbot, AntiAFK, Spectate tá»« script gá»‘c
-- CÃ¡c hÃ m GetPlayerRole, CreateESPHitbox, RemoveESPHitbox
-- CÃ¡c káº¿t ná»‘i sá»± kiá»‡n PlayerAdded/Removing
-- CÃ¡c tab switching vÃ  pháº§n GUI cÃ²n láº¡i

-- Káº¿t ná»‘i Heartbeat cho cÃ¡c tÃ­nh nÄƒng khÃ¡c
RunService.Heartbeat:Connect(function()
    if ESPEnabled then
        for _, player in pairs(Players:GetPlayers()) do
            if player ~= LocalPlayer then
                if not ESPHitboxes[player] then
                    CreateESPHitbox(player)
                end
            end
        end
    end
    
    if AimbotEnabled then
        -- Aimbot logic here
    end
end)

-- Initialize AntiAFK
local function AntiAFK()
    if AntiAFKEnabled then
        local VirtualUser = game:GetService("VirtualUser")
        LocalPlayer.Idled:Connect(function()
            VirtualUser:CaptureController()
            VirtualUser:ClickButton2(Vector2.new())
        end)
    end
end

AntiAFK()
